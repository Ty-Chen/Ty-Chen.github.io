<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/kulamati128.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/kulamati32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/kulamati16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Linux,操作系统,内存,性能优化," />










<meta name="description" content="一. 前言&amp;emsp;&amp;emsp;本文是性能优化系列的最后一篇，将分析磁盘I&#x2F;O的性能指标、测试方法、常见问题的优化套路等内容。">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux操作系统学习笔记（二十七）磁盘I&#x2F;O性能优化">
<meta property="og:url" content="https://ty-chen.github.io/linux-kernel-IO-optimization/index.html">
<meta property="og:site_name" content="Ty-Chen&#39;s Home">
<meta property="og:description" content="一. 前言&amp;emsp;&amp;emsp;本文是性能优化系列的最后一篇，将分析磁盘I&#x2F;O的性能指标、测试方法、常见问题的优化套路等内容。">
<meta property="og:image" content="https://static001.geekbang.org/resource/image/cf/8d/cff31e715af51c9cb8085ce1bb48318d.png">
<meta property="og:image" content="https://static001.geekbang.org/resource/image/6f/98/6f26fa18a73458764fcda00212006698.png">
<meta property="og:image" content="https://static001.geekbang.org/resource/image/18/8a/1802a35475ee2755fb45aec55ed2d98a.png">
<meta property="article:published_time" content="2020-09-26T08:06:36.000Z">
<meta property="article:modified_time" content="2020-10-18T15:22:54.542Z">
<meta property="article:author" content="Ty Chen">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="操作系统">
<meta property="article:tag" content="内存">
<meta property="article:tag" content="性能优化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://static001.geekbang.org/resource/image/cf/8d/cff31e715af51c9cb8085ce1bb48318d.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ty-chen.github.io/linux-kernel-IO-optimization/"/>





  <title>Linux操作系统学习笔记（二十七）磁盘I/O性能优化 | Ty-Chen's Home</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ty-Chen's Home</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Collecting, sharing and creating knowledge</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ty-chen.github.io/linux-kernel-IO-optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ty Chen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/me.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ty-Chen's Home">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux操作系统学习笔记（二十七）磁盘I/O性能优化</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-09-26T16:06:36+08:00">
                2020-09-26
              </time>
            

            

            
          </span>
          
            <span class="post-updated">
              &nbsp; | &nbsp; 更新于
              <time itemprop="dateUpdated" datetime="2020-10-18T23:22:54+08:00" content="2020-10-18">
                2020-10-18
              </time>
            </span>
          
          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index">
                    <span itemprop="name">Linux操作系统内核学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/linux-kernel-IO-optimization/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/linux-kernel-IO-optimization/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">访问次数：
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  18
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一. 前言"></a>一. 前言</h2><p>&emsp;&emsp;本文是性能优化系列的最后一篇，将分析磁盘I/O的性能指标、测试方法、常见问题的优化套路等内容。</p>
<a id="more"></a>

<h2 id="二-I-O性能指标及查询工具"><a href="#二-I-O性能指标及查询工具" class="headerlink" title="二. I/O性能指标及查询工具"></a>二. I/O性能指标及查询工具</h2><p>&emsp;&emsp;磁盘性能的衡量标准经常用到的包括使用率、饱和度、IOPS、吞吐量以及响应时间等。这五个指标是衡量磁盘性能的基本指标。</p>
<ul>
<li>使用率，是指磁盘处理 I/O 的时间百分比。过高的使用率（比如超过 80%），通常意味着磁盘 I/O 存在性能瓶颈。</li>
<li>饱和度，是指磁盘处理 I/O 的繁忙程度。过高的饱和度，意味着磁盘存在严重的性能瓶颈。当饱和度为 100% 时，磁盘无法接受新的 I/O 请求。</li>
<li>IOPS（Input/Output Per Second），是指每秒的 I/O 请求数。</li>
<li>吞吐量，是指每秒的 I/O 请求大小。</li>
<li>响应时间，是指 I/O 请求从发出到收到响应的间隔时间。</li>
</ul>
<h3 id="2-1-磁盘I-O性能观测"><a href="#2-1-磁盘I-O性能观测" class="headerlink" title="2.1 磁盘I/O性能观测"></a>2.1 磁盘I/O性能观测</h3><p>&emsp;&emsp;<code>iostat</code> 是最常用的磁盘 I/O 性能观测工具，它提供了每个磁盘的使用率、IOPS、吞吐量等各种常见的性能指标，当然，这些指标实际上来自 <code>/proc/diskstats</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> -d -x表示显示所有磁盘I/O的指标</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> iostat -d -x 1 </span></span><br><span class="line">Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util </span><br><span class="line">loop0            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 </span><br><span class="line">loop1            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 </span><br><span class="line">sda              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 </span><br><span class="line">sdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00</span><br></pre></td></tr></table></figure>

<img src="https://static001.geekbang.org/resource/image/cf/8d/cff31e715af51c9cb8085ce1bb48318d.png" alt="img" style="zoom: 25%;" />

<ul>
<li><code>%util</code> ，就是我们前面提到的磁盘 I/O 使用率；</li>
<li><code>r/s + w/s</code> ，就是 IOPS；</li>
<li><code>rkB/s + wkB/s</code> ，就是吞吐量；</li>
<li><code>r_await + w_await</code> ，就是响应时间。</li>
</ul>
<p>从 <code>iostat</code> 并不能直接得到磁盘饱和度。事实上，饱和度通常也没有其他简单的观测方法，不过，你可以把观测到的平均请求队列长度或者读写请求完成的等待时间，跟基准测试的结果（比如通过 <code>fio</code>）进行对比，综合评估磁盘的饱和情况。</p>
<h3 id="2-2df命令"><a href="#2-2df命令" class="headerlink" title="2.2df命令"></a>2.2<code>df</code>命令</h3><p>&emsp;&emsp;<code>df</code> 命令能查看文件系统的磁盘空间使用情况，索引节点的容量（也就是 <code>Inode</code> 个数）是在格式化磁盘时设定好的，一般由格式化工具自动生成。当你发现索引节点空间不足，但磁盘空间充足时，很可能就是过多小文件导致的。一般来说，删除这些小文件，或者把它们移动到索引节点充足的其他磁盘中，就可以解决这个问题。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> df /dev/sda1 </span></span><br><span class="line">Filesystem     1K-blocks    Used Available Use% Mounted on </span><br><span class="line">/dev/sda1       30308240 3167020  27124836  11% / </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -i表示查看索引节点使用情况</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> df -i /dev/sda1 </span></span><br><span class="line">Filesystem Inodes IUsed IFree IUse% Mounted on </span><br><span class="line">/dev/sda1 3870720 157460 3713260 5% /</span><br></pre></td></tr></table></figure>

<h3 id="2-3-slabtop"><a href="#2-3-slabtop" class="headerlink" title="2.3 slabtop"></a>2.3 <code>slabtop</code></h3><p>&emsp;&emsp;内核使用 Slab 机制，管理目录项和索引节点的缓存。<code>/proc/meminfo</code> 只给出了 Slab 的整体大小，具体到每一种 Slab 缓存，还要查看 <code>/proc/slabinfo</code> 这个文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/slabinfo | grep -E <span class="string">'^#|dentry|inode'</span> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;<span class="built_in">limit</span>&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_slabs&gt; &lt;sharedavail&gt; </span></span><br><span class="line">xfs_inode              0      0    960   17    4 : tunables    0    0    0 : slabdata      0      0      0 </span><br><span class="line">... </span><br><span class="line">ext4_inode_cache   32104  34590   1088   15    4 : tunables    0    0    0 : slabdata   2306   2306      0hugetlbfs_inode_cache     13     13    624   13    2 : tunables    0    0    0 : slabdata      1      1      0 </span><br><span class="line">sock_inode_cache    1190   1242    704   23    4 : tunables    0    0    0 : slabdata     54     54      0 </span><br><span class="line">shmem_inode_cache   1622   2139    712   23    4 : tunables    0    0    0 : slabdata     93     93      0 </span><br><span class="line">proc_inode_cache    3560   4080    680   12    2 : tunables    0    0    0 : slabdata    340    340      0 </span><br><span class="line">inode_cache        25172  25818    608   13    2 : tunables    0    0    0 : slabdata   1986   1986      0 </span><br><span class="line">dentry             76050 121296    192   21    1 : tunables    0    0    0 : slabdata   5776   5776      0</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;<code>/proc/slabinfo</code> 的列比较多，具体含义你可以查询 <code>man slabinfo</code>。在实际性能分析中，我们更常使用 <code>slabtop</code> ，来找到占用内存最多的缓存类型。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 按下c按照缓存大小排序，按下a按照活跃对象数排序 </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> slabtop </span></span><br><span class="line">Active / Total Objects (% used)    : 277970 / 358914 (77.4%) </span><br><span class="line">Active / Total Slabs (% used)      : 12414 / 12414 (100.0%) </span><br><span class="line">Active / Total Caches (% used)     : 83 / 135 (61.5%) </span><br><span class="line">Active / Total Size (% used)       : 57816.88K / 73307.70K (78.9%) </span><br><span class="line">Minimum / Average / Maximum Object : 0.01K / 0.20K / 22.88K </span><br><span class="line"></span><br><span class="line">  OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME </span><br><span class="line">69804  23094   0%    0.19K   3324       21     13296K dentry </span><br><span class="line">16380  15854   0%    0.59K   1260       13     10080K inode_cache </span><br><span class="line">58260  55397   0%    0.13K   1942       30      7768K kernfs_node_cache </span><br><span class="line">   485    413   0%    5.69K     97        5      3104K task_struct </span><br><span class="line">  1472   1397   0%    2.00K     92       16      2944K kmalloc-2048</span><br></pre></td></tr></table></figure>

<h3 id="2-4-进程I-O检测"><a href="#2-4-进程I-O检测" class="headerlink" title="2.4 进程I/O检测"></a>2.4 进程I/O检测</h3><p>&emsp;&emsp;<code>iostat</code> 只提供磁盘整体的 I/O 性能数据，缺点在于并不能知道具体是哪些进程在进行磁盘读写。要观察进程的 I/O 情况，可以使用 <code>pidstat</code> 和 <code>iotop</code> 这两个工具进行检测。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pidstat -d 1 </span></span><br><span class="line">13:39:51      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command </span><br><span class="line">13:39:52      102       916      0.00      4.00      0.00       0  rsyslogd</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;<code>iotop</code>是一个类似于 top 的工具，可以按照 I/O 大小对进程排序，然后找到 I/O 较大的那些进程。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> iotop</span></span><br><span class="line">Total DISK READ :       0.00 B/s | Total DISK WRITE :       7.85 K/s </span><br><span class="line">Actual DISK READ:       0.00 B/s | Actual DISK WRITE:       0.00 B/s </span><br><span class="line">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND </span><br><span class="line">15055 be/3 root        0.00 B/s    7.85 K/s  0.00 %  0.00 % systemd-journald</span><br></pre></td></tr></table></figure>

<h3 id="2-5-进程追踪"><a href="#2-5-进程追踪" class="headerlink" title="2.5 进程追踪"></a>2.5 进程追踪</h3><p>&emsp;&emsp;发现了可能存在I/O问题得进程后，我们可以使用<code>strace -p</code>来追踪指定进程的调用堆栈</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> strace -p 18940 </span></span><br><span class="line">strace: Process 18940 attached </span><br><span class="line">...</span><br><span class="line">mmap(NULL, 314576896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0f7aee9000 </span><br><span class="line">mmap(NULL, 314576896, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f0f682e8000 </span><br><span class="line">write(3, "2018-12-05 15:23:01,709 - __main"..., 314572844 </span><br><span class="line">) = 314572844 </span><br><span class="line">munmap(0x7f0f682e8000, 314576896)       = 0 </span><br><span class="line">write(3, "\n", 1)                       = 1 </span><br><span class="line">munmap(0x7f0f7aee9000, 314576896)       = 0 </span><br><span class="line">close(3)                                = 0 </span><br><span class="line">stat("/tmp/logtest.txt.1", &#123;st_mode=S_IFREG|0644, st_size=943718535, ...&#125;) = 0</span><br></pre></td></tr></table></figure>

<h3 id="2-6-进程I-O文件使用"><a href="#2-6-进程I-O文件使用" class="headerlink" title="2.6 进程I/O文件使用"></a>2.6 进程I/O文件使用</h3><p>&emsp;&emsp;通过<code>lsof</code>工具，我们可以查看指定进程打开了哪些文件。注意这里-p后面必须跟进程pid，线程的无效。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> lsof -p 18940 </span></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE  SIZE/OFF    NODE NAME </span><br><span class="line">python  18940 root  cwd    DIR   0,50      4096 1549389 / </span><br><span class="line">python  18940 root  rtd    DIR   0,50      4096 1549389 / </span><br><span class="line">… </span><br><span class="line">python  18940 root    2u   CHR  136,0       0t0       3 /dev/pts/0 </span><br><span class="line">python  18940 root    3w   REG    8,1 117944320     303 /tmp/logtest.txt</span><br></pre></td></tr></table></figure>

<h3 id="2-7-内核读写检测工具"><a href="#2-7-内核读写检测工具" class="headerlink" title="2.7 内核读写检测工具"></a>2.7 内核读写检测工具</h3><p>&emsp;&emsp;<code>filetop</code>基于 Linux 内核的 eBPF机制，主要跟踪内核中文件的读写情况，并输出线程 ID（TID）、读写大小、读写类型以及文件名称。filetop 输出了 8 列内容，分别是线程 ID、线程命令行、读写次数、读写的大小（单位 KB）、文件类型以及读写的文件名称。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切换到工具目录 </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /usr/share/bcc/tools </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -C 选项表示输出新内容时不清空屏幕 </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./filetop -C </span></span><br><span class="line"></span><br><span class="line">TID    COMM             READS  WRITES R_Kb    W_Kb    T FILE </span><br><span class="line">514    python           0      1      0       2832    R 669.txt </span><br><span class="line">514    python           0      1      0       2490    R 667.txt </span><br><span class="line">514    python           0      1      0       2685    R 671.txt </span><br><span class="line">514    python           0      1      0       2392    R 670.txt </span><br><span class="line">514    python           0      1      0       2050    R 672.txt </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">TID    COMM             READS  WRITES R_Kb    W_Kb    T FILE </span><br><span class="line">514    python           2      0      5957    0       R 651.txt </span><br><span class="line">514    python           2      0      5371    0       R 112.txt </span><br><span class="line">514    python           2      0      4785    0       R 861.txt </span><br><span class="line">514    python           2      0      4736    0       R 213.txt </span><br><span class="line">514    python           2      0      4443    0       R 45.txt</span><br></pre></td></tr></table></figure>

<h3 id="2-8-open系统调用内核追踪"><a href="#2-8-open系统调用内核追踪" class="headerlink" title="2.8 open系统调用内核追踪"></a>2.8 open系统调用内核追踪</h3><p>&emsp;&emsp;<code>opensnoop</code> 工具同属于 bcc 软件包，可以动态跟踪内核中的 open 系统调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ opensnoop </span><br><span class="line">12280  python              6   0 &#x2F;tmp&#x2F;9046db9e-fe25-11e8-b13f-0242ac110002&#x2F;650.txt </span><br><span class="line">12280  python              6   0 &#x2F;tmp&#x2F;9046db9e-fe25-11e8-b13f-0242ac110002&#x2F;651.txt </span><br><span class="line">12280  python              6   0 &#x2F;tmp&#x2F;9046db9e-fe25-11e8-b13f-0242ac110002&#x2F;652.txt</span><br></pre></td></tr></table></figure>

<h3 id="2-9-nsenter容器追踪工具"><a href="#2-9-nsenter容器追踪工具" class="headerlink" title="2.9 nsenter容器追踪工具"></a>2.9 <code>nsenter</code>容器追踪工具</h3><p>&emsp;&emsp;<code>nsenter</code>和以上I/O工具配合，可以可以进入容器命名空间内部观测其I/O使用情况</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 由于这两个容器共享同一个网络命名空间，所以我们只需要进入app的网络命名空间即可</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> PID=$(docker inspect --format &#123;&#123;.State.Pid&#125;&#125; app)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -i表示显示网络套接字信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> nsenter --target <span class="variable">$PID</span> --net -- lsof -i</span></span><br><span class="line">COMMAND    PID            USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME</span><br><span class="line">redis-ser 9085 systemd-network    6u  IPv4 15447972      0t0  TCP localhost:6379 (LISTEN)</span><br><span class="line">redis-ser 9085 systemd-network    8u  IPv4 15448709      0t0  TCP localhost:6379-&gt;localhost:32996 (ESTABLISHED)</span><br><span class="line">python    9181            root    3u  IPv4 15448677      0t0  TCP *:http (LISTEN)</span><br><span class="line">python    9181            root    5u  IPv4 15449632      0t0  TCP localhost:32996-&gt;localhost:6379 (ESTABLISHED)</span><br></pre></td></tr></table></figure>

<img src="https://static001.geekbang.org/resource/image/6f/98/6f26fa18a73458764fcda00212006698.png" alt="img" style="zoom:33%;" />

<h2 id="三-I-O压测工具"><a href="#三-I-O压测工具" class="headerlink" title="三. I/O压测工具"></a>三. I/O压测工具</h2><p>&emsp;&emsp;<code>fio</code>（Flexible I/O Tester）是最常用的文件系统和磁盘 I/O 性能基准测试工具。它提供了大量的可定制化选项，可以用来测试，裸盘或者文件系统在各种场景下的 I/O 性能，包括了不同块大小、不同 I/O 引擎以及是否使用缓存等场景。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 随机读</span></span><br><span class="line">fio -name=randread -direct=1 -iodepth=64 -rw=randread -ioengine=libaio -bs=4k -size=1G -numjobs=1 -runtime=1000 -group_reporting -filename=/dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 随机写</span></span><br><span class="line">fio -name=randwrite -direct=1 -iodepth=64 -rw=randwrite -ioengine=libaio -bs=4k -size=1G -numjobs=1 -runtime=1000 -group_reporting -filename=/dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 顺序读</span></span><br><span class="line">fio -name=read -direct=1 -iodepth=64 -rw=read -ioengine=libaio -bs=4k -size=1G -numjobs=1 -runtime=1000 -group_reporting -filename=/dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 顺序写</span></span><br><span class="line">fio -name=write -direct=1 -iodepth=64 -rw=write -ioengine=libaio -bs=4k -size=1G -numjobs=1 -runtime=1000 -group_reporting -filename=/dev/sdb</span><br></pre></td></tr></table></figure>

<ul>
<li><code>direct</code>，表示是否跳过系统缓存。上面示例中，我设置的 1 ，就表示跳过系统缓存。</li>
<li><code>iodepth</code>，表示使用异步 I/O（asynchronous I/O，简称 AIO）时，同时发出的 I/O 请求上限。在上面的示例中设置的是 64。</li>
<li><code>rw</code>，表示 I/O 模式。示例中， <code>read/write</code> 分别表示顺序读 / 写，而 <code>randread/randwrite</code> 则分别表示随机读 / 写。</li>
<li><code>ioengine</code>，表示 I/O 引擎，它支持同步（sync）、异步（<code>libaio</code>）、内存映射（<code>mmap</code>）、网络（<code>net</code>）等各种 I/O 引擎。上面示例中设置的 <code>libaio</code> 表示使用异步 I/O。</li>
<li><code>bs</code>，表示 I/O 的大小。示例中设置成了 4K（这也是默认值）。</li>
<li><code>filename</code>，表示文件路径，当然，它可以是磁盘路径（测试磁盘性能），也可以是文件路径（测试文件系统性能）。示例中设置成了磁盘 <code>/dev/sdb</code>。不过注意，用磁盘路径测试写，会破坏这个磁盘中的文件系统，所以在使用前一定要事先做好数据备份。</li>
</ul>
<p>&emsp;&emsp;通常情况下，应用程序的 I/O 都是读写并行的，而且每次的 I/O 大小也不一定相同。所以，刚刚说的这几种场景，并不能精确模拟应用程序的 I/O 模式。那怎么才能精确模拟应用程序的 I/O 模式呢？幸运的是，<code>fio</code> 支持 I/O 的重放。借助前面提到过的 <code>blktrace</code>，再配合上 <code>fio</code>，就可以实现对应用程序 I/O 模式的基准测试。先用 <code>blktrace</code> ，记录磁盘设备的 I/O 访问情况；然后使用 <code>fio</code> ，重放 <code>blktrace</code> 的记录。这样就通过 <code>blktrace + fio</code> 的组合使用，得到了应用程序 I/O 模式的基准测试报告。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用blktrace跟踪磁盘I/O，注意指定应用程序正在操作的磁盘</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> blktrace /dev/sdb</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看blktrace记录的结果</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls</span></span><br><span class="line">sdb.blktrace.0  sdb.blktrace.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将结果转化为二进制文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> blkparse sdb -d sdb.bin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用fio重放日志</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> fio --name=replay --filename=/dev/sdb --direct=1 --read_iolog=sdb.bin</span></span><br></pre></td></tr></table></figure>

<h2 id="四-I-O性能优化思路"><a href="#四-I-O性能优化思路" class="headerlink" title="四.  I/O性能优化思路"></a>四.  I/O性能优化思路</h2><p>&emsp;&emsp;从 I/O 角度来分析，最开始的分析思路基本上类似，都是：</p>
<ul>
<li>先用 <code>iostat</code> 发现磁盘 I/O 性能瓶颈；</li>
<li>再借助 <code>pidstat</code> ，定位出导致瓶颈的进程；</li>
<li>随后分析进程的 I/O 行为；</li>
<li>最后，结合应用程序的原理，分析这些 I/O 的来源。</li>
</ul>
<p><img src="https://static001.geekbang.org/resource/image/18/8a/1802a35475ee2755fb45aec55ed2d98a.png" alt="img"></p>
<h3 id="4-1-应用层优化"><a href="#4-1-应用层优化" class="headerlink" title="4.1 应用层优化"></a>4.1 应用层优化</h3><p>&emsp;&emsp;应用层主要有以下常见优化点：</p>
<ul>
<li>用追加写代替随机写，减少寻址开销，加快 I/O 写的速度</li>
<li>借助缓存 I/O ，充分利用系统缓存，降低实际 I/O 的次数</li>
<li>在应用程序内部构建自己的缓存，或者用 <code>Redis</code> 这类外部缓存系统。这样，一方面，能在应用程序内部，控制缓存的数据和生命周期；另一方面，也能降低其他应用程序使用缓存对自身的影响。</li>
<li>在需要频繁读写同一块磁盘空间时，可以用 <code>mmap</code> 代替 read/write，减少内存的拷贝次数</li>
<li>在需要同步写的场景中，尽量将写请求合并，而不是让每个请求都同步写入磁盘，即可以用 <code>fsync()</code> 取代 <code>O_SYNC</code></li>
<li>在多个应用程序共享相同磁盘时，为了保证 I/O 不被某个应用完全占用，推荐使用 <code>cgroups</code> 的 I/O 子系统，来限制进程 / 进程组的 IOPS 以及吞吐量</li>
<li>在使用 CFQ 调度器时，可以用 <code>ionice</code> 来调整进程的 I/O 调度优先级，特别是提高核心应用的 I/O 优先级。<code>ionice</code> 支持三个优先级类：Idle、Best-effort 和 Realtime。其中， Best-effort 和 Realtime 还分别支持 0-7 的级别，数值越小，则表示优先级别越高。</li>
</ul>
<h3 id="4-2-文件系统优化"><a href="#4-2-文件系统优化" class="headerlink" title="4.2 文件系统优化"></a>4.2 文件系统优化</h3><p>&emsp;&emsp;文件系统主要存在以下优化点：</p>
<ul>
<li>根据实际负载场景的不同，选择最适合的文件系统。比如 Ubuntu 默认使用 ext4 文件系统，而 CentOS 7 默认使用 <code>xfs</code> 文件系统。相比于 ext4 ，<code>xfs</code> 支持更大的磁盘分区和更大的文件数量，如 <code>xfs</code> 支持大于 16TB 的磁盘。但是 <code>xfs</code> 文件系统的缺点在于无法收缩，而 ext4 则可以。</li>
<li>选好文件系统后，还可以进一步优化文件系统的配置选项，包括文件系统的特性（如 <code>ext_attr</code>、<code>dir_index</code>）、日志模式（如 <code>journal</code>、<code>ordered</code>、<code>writeback</code>）、挂载选项（如 <code>noatime</code>）等等。</li>
<li>优化文件系统的缓存。比如可以优化 <code>pdflush</code> 脏页的刷新频率（比如设置 <code>dirty_expire_centisecs</code> 和 <code>dirty_writeback_centisecs</code>）以及脏页的限额（比如调整 <code>dirty_background_ratio</code> 和 <code>dirty_ratio</code> 等）。再如还可以优化内核回收目录项缓存和索引节点缓存的倾向，即调整 <code>vfs_cache_pressure</code>（<code>/proc/sys/vm/vfs_cache_pressure</code>，默认值 100），数值越大，就表示越容易回收。最后，在不需要持久化时还可以用内存文件系统 <code>tmpfs</code>以获得更好的 I/O 性能 。<code>tmpfs</code> 把数据直接保存在内存中，而不是磁盘中。比如 <code>/dev/shm/</code> ，就是大多数 Linux 默认配置的一个内存文件系统，它的大小默认为总内存的一半。</li>
</ul>
<h3 id="4-3-磁盘优化"><a href="#4-3-磁盘优化" class="headerlink" title="4.3 磁盘优化"></a>4.3 磁盘优化</h3><p>&emsp;&emsp;磁盘是整个 I/O 栈的最底层。从磁盘角度出发，自然也有很多有效的性能优化方法。</p>
<ul>
<li>使用 RAID ，把多块磁盘组合成一个逻辑磁盘，构成冗余独立磁盘阵列。这样做既可以提高数据的可靠性，又可以提升数据的访问性能。</li>
<li>针对磁盘和应用程序 I/O 模式的特征可以选择最适合的 I/O 调度算法。比方说，SSD 和虚拟机中的磁盘，通常用的是 <code>noop</code> 调度算法。而数据库应用，我更推荐使用 <code>deadline</code> 算法。</li>
<li>对应用程序的数据，进行磁盘级别的隔离。比如可以为日志、数据库等 I/O 压力比较重的应用，配置单独的磁盘。</li>
<li>在顺序读比较多的场景中可以增大磁盘的预读数据，比如可以通过下面两种方法，调整 <code>/dev/sdb</code> 的预读大小。<ul>
<li>调整内核选项 <code>/sys/block/sdb/queue/read_ahead_kb</code>，默认大小是 128 KB，单位为 KB。</li>
<li>使用 <code>blockdev</code> 工具设置，比如 <code>blockdev --setra 8192 /dev/sdb</code>，注意这里的单位是 512B（0.5KB），所以它的数值总是 <code>read_ahead_kb</code> 的两倍。</li>
</ul>
</li>
<li>优化内核块设备 I/O 的选项。比如，可以调整磁盘队列的长度 <code>/sys/block/sdb/queue/nr_requests</code>，适当增大队列长度，可以提升磁盘的吞吐量（当然也会导致 I/O 延迟增大）。</li>
<li>磁盘本身出现硬件错误，也会导致 I/O 性能急剧下降，所以发现磁盘性能急剧下降时还需要确认，磁盘本身是不是出现了硬件错误。比如可以查看 <code>dmesg</code> 中是否有硬件 I/O 故障的日志。 还可以使用 <code>badblocks</code>、<code>smartctl</code> 等工具，检测磁盘的硬件问题，或用 <code>e2fsck</code> 等来检测文件系统的错误。如果发现问题，可以使用 <code>fsck</code> 等工具来修复。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>&emsp;&emsp;本文大致总结了磁盘I/O相关的性能指标、检测工具、压测工具以及优化思路。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1] Linux-insides</p>
<p>[2] 深入理解Linux内核</p>
<p>[3] Linux内核设计的艺术</p>
<p>[4] 深入理解计算机系统</p>
<p>[5] 深入理解Linux网络技术内幕</p>
<p>[6] shell脚本编程大全</p>
<p>[7] 极客时间 Linux性能优化实战</p>
<p>[8] 极客时间 系统性能调优必知必会</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创，坚持分享，谢谢鼓励和支持</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="Ty Chen 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Ty Chen 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Ty Chen
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://ty-chen.github.io/linux-kernel-IO-optimization/" title="Linux操作系统学习笔记（二十七）磁盘I/O性能优化">https://ty-chen.github.io/linux-kernel-IO-optimization/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
            <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag"># 操作系统</a>
          
            <a href="/tags/%E5%86%85%E5%AD%98/" rel="tag"># 内存</a>
          
            <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag"># 性能优化</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/linux-kernel-memory-optimization/" rel="next" title="Linux操作系统学习笔记（二十六）内存性能优化">
                <i class="fa fa-chevron-left"></i> Linux操作系统学习笔记（二十六）内存性能优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/this-and-that-1/" rel="prev" title="杂谈之新人和导师">
                杂谈之新人和导师 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/me.JPG"
                alt="Ty Chen" />
            
              <p class="site-author-name" itemprop="name">Ty Chen</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Ty-Chen" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:tianyuch@hotmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Friends
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lishouxian.cn/" title="Stanleylsx" target="_blank">Stanleylsx</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一-前言"><span class="nav-text">一. 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-I-O性能指标及查询工具"><span class="nav-text">二. I&#x2F;O性能指标及查询工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-磁盘I-O性能观测"><span class="nav-text">2.1 磁盘I&#x2F;O性能观测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2df命令"><span class="nav-text">2.2df命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-slabtop"><span class="nav-text">2.3 slabtop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-进程I-O检测"><span class="nav-text">2.4 进程I&#x2F;O检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-进程追踪"><span class="nav-text">2.5 进程追踪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-进程I-O文件使用"><span class="nav-text">2.6 进程I&#x2F;O文件使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-内核读写检测工具"><span class="nav-text">2.7 内核读写检测工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-open系统调用内核追踪"><span class="nav-text">2.8 open系统调用内核追踪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-9-nsenter容器追踪工具"><span class="nav-text">2.9 nsenter容器追踪工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-I-O压测工具"><span class="nav-text">三. I&#x2F;O压测工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四-I-O性能优化思路"><span class="nav-text">四.  I&#x2F;O性能优化思路</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-应用层优化"><span class="nav-text">4.1 应用层优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-文件系统优化"><span class="nav-text">4.2 文件系统优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-磁盘优化"><span class="nav-text">4.3 磁盘优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文献"><span class="nav-text">参考文献</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2020 &mdash; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ty Chen</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">191.2k</span>
  
  <a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener">粤ICP备20071543号</a> 
</div>









        
<div class="busuanzi-count">
	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>

  
    <span class="site-uv">
      你是来访的第
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      位同学
    </span>
  

  
    <span class="site-pv">
      访问次数：
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'aTqo2eFkO2Bn0AGX008uKDV7-gzGzoHsz',
        appKey: 'uJ6nxqW7RHWpAILCtttkJfJu',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
